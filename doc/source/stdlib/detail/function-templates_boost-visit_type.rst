note: visit returns smart_ptr_raw, so we need to be careful with lifetime here
